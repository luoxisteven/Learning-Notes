# A/B Test

A/B Test 是通过对比两个或多个方案，测试哪个方案表现更优的一种方法。通常通过某个指标的变化进行对比。

## A/B Test 流程

1. **明确实验目的**：
   - 新功能或多个项目的目标是否提升回报、利润、投资回报率（ROI）、转化率等。
   - 需要挑选一个关键指标，以确定新功能或哪个项目表现更优。

2. **假设检验**：
   - 提出原假设（Null Hypothesis）和备择假设（Alternative Hypothesis）。
   
3. **设定显著性水平**：
   - 设定显著性水平，并确定最小可接受阀值。

4. **确定样本量和实验时间**：
   - 计算所需样本量并设定实验持续时间。

5. **计算结果**：
   - 通过结果分析，确定是否拒绝原假设，得出哪个方案更优。

## A/B Test 可能的失败原因

1. **新奇效应**：
   - 一开始客户对新功能表现出兴趣，但随着时间推移，兴趣减弱，导致效果不再显著。

2. **样本量不足**：
   - 样本量不够大，导致实验结果不准确或无法得出显著性结论。

3. **外部因素干扰**：
   - 例如洪水、地震、政策变化等外部事件可能影响实验结果。
   - 由于对比实验有时并非同时进行，不同时间段发生的事件可能间接影响实验结果。

## A/B Test 涉及的统计学原理

- **假设检验**：通过假设检验确定实验结果的显著性，决定是否拒绝原假设。

## A/B 实验需要进行几天才能满足显著性要求？如何评估？

A/B 实验的持续时间主要取决于以下几个因素：
1. **样本量**：
   - 样本量越大，越容易观察到显著性差异。需要通过样本量计算公式估算合适的样本量（后面会具体说明）。

2. **基准转化率**：
   - 实验开始前，需要知道当前的转化率，以此为基准来判断新方案是否有显著改进。

3. **预期提升幅度**：
   - 预估新方案相较于现有方案会带来多大提升。预期提升越小，所需样本量越大。

4. **显著性水平和检验功效**：
   - 显著性水平通常设为 5%（即 95% 的置信度），检验功效通常设为 80%。显著性水平影响我们在计算样本量时的精度要求。

## 评估 A/B 实验的持续时间

评估实验持续时间的关键是：
- 确定需要的**总样本量**。
- 通过估算**日均流量**，判断需要多少天才能获得足够的样本。
  
例如：
- 如果计算出的样本量为 5000 人，且每天约有 1000 人参与实验，那么至少需要 5 天才能完成实验。

## 如何确定 A/B 实验的样本量？

样本量的计算公式通常基于以下参数：
- **基准转化率（Baseline Conversion Rate）**：实验前的转化率。
- **预期提升幅度（Minimum Detectable Effect, MDE）**：假设新方案会带来的最小转化率提升。
- **显著性水平（Significance Level, Alpha）**：通常设定为 0.05（5%）。
- **检验功效（Statistical Power, Beta）**：通常设定为 0.80（80%）。

样本量计算公式为：

$$
n = \frac{{Z_{\alpha/2}^2 \cdot p_1 (1 - p_1) + Z_{\beta}^2 \cdot p_2 (1 - p_2)}}{{(p_1 - p_2)^2}}
$$

- $p_1$是基准转化率
- $p_2$ 是预期提升后的转化率
- $Z_{\alpha/2}$是显著性水平对应的标准正态分布值（1.96 对应于 95% 的显著性水平）
- $Z_{\beta}$是检验功效对应的标准正态分布值（0.84 对应于 80% 的检验功效）

![alt text](<img/Pasted Graphic.jpg>)

## AB 实验流量分桶时需要保证的原则

1. **随机性**：
   - 不同的实验组的分配尽量随机，避免系统性偏差。

2. **独立性**：
   - 保证每个实验桶的用户体验是独立的，避免实验组之间的相互影响。

3. **均匀性**：
   - 各个桶内的样本量要尽量相似，以保证实验结果的可比性。

4. **一致性**：
   - 同一个用户在整个实验过程中应该始终分配到同一实验组，避免跨组跳跃带来的干扰。

# 如何解决流量不足问题

为了解决流量不足的问题，A/B 实验可以采用**多臂赌博机方法（Multi-Armed Bandit, MAB）**，其中常见的算法是**上置信界（Upper Confidence Bound, UCB）**。

- **Multi-Armed Bandit (MAB)**：
   - 这是一种在不确定环境下通过探索和利用的平衡，动态调整资源分配的策略。它在实验过程中更频繁地分配流量给表现较好的方案，从而提高流量利用率。

- **UCB 算法**：
   - 通过不断评估各个实验组的表现，并根据表现给出一个“置信界”，将更多流量分配给有潜力的实验组，同时仍然保持一定的探索以发现潜在的更优解。

## 什么是 AA 实验？

- **AA 实验**：是在没有引入任何新功能或变化的情况下，对同一组或同一个桶内的数据进行 A/B 实验，以验证是否存在显著性差异。
  
- **目的**：AA 实验的目的是确保实验的分流逻辑和数据收集方式没有问题。如果 AA 实验结果显示存在显著性差异，意味着数据采集或实验分流可能存在偏差，需要重新收集或修正数据。

- **期望结果**：AA 实验的期望结果是**没有显著性差异**，即两组数据应保持相似性。


